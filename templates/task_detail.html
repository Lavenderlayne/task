{% extends 'base.html' %}

{% block content %}
<div class="card bg-dark text-light border border-secondary rounded-4 p-4">
    <h1 class="h4 fw-bold text-uppercase mb-3">–ó–∞–≤–¥–∞–Ω–Ω—è: {{ task.title }}</h1>

    <ul class="list-group list-group-flush mb-3">
        <li class="list-group-item bg-transparent d-flex justify-content-between align-items-center border-start border-4 border-secondary text-light">
            <strong>–°—Ç–∞—Ç—É—Å:</strong>
            <span class="badge rounded-pill fw-semibold
                {% if task.status == 'completed' %}bg-light text-dark
                {% elif task.status == 'in_progress' %}bg-secondary text-light
                {% else %}bg-dark text-secondary
                {% endif %}">
                {{ task.get_status_display }}
            </span>
        </li>
        <li class="list-group-item bg-transparent d-flex justify-content-between align-items-center border-start border-4 border-secondary text-light">
            <strong>–ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç:</strong>
            <span class="badge bg-secondary text-light rounded-pill fw-semibold">{{ task.get_priority_display }}</span>
        </li>
        <li class="list-group-item bg-transparent border-start border-4 border-secondary text-light">
            <strong>–û–ø–∏—Å:</strong>
            <p class="mt-2 mb-0">{{ task.description|linebreaks }}</p>
        </li>
    </ul>

    <small class="text-secondary d-block text-end fst-italic">
        –°—Ç–≤–æ—Ä–µ–Ω–æ: {{ task.created_by.username }} &mdash; {{ task.created_at|date:"d.m.Y H:i" }}
    </small>
</div>

<hr class="border-secondary my-4">

<div class="card bg-dark border border-secondary rounded-4 p-4 text-light mb-4">
    <h2 class="h5 fw-bold mb-3">–ö–æ–º–µ–Ω—Ç–∞—Ä—ñ</h2>

    {% if comments %}
        <ul class="list-group list-group-flush">
            {% for comment in comments %}
                <li class="list-group-item bg-transparent border-secondary text-light">
                    <p class="mb-1"><strong>{{ comment.author }}</strong>: {{ comment.content }}</p>
                    {% if comment.file %}
                        <p><a href="{{ comment.file.url }}" class="link-light" download>üìé {{ comment.file.name }}</a></p>
                    {% endif %}
                    <p class="mb-1">{{ comment.likes.count }} ‚ù§</p>
                    <form method="post" action="{% url 'like_comment' comment.pk %}" class="d-inline">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-sm btn-outline-light">–õ–∞–π–∫</button>
                    </form>
                    <small class="d-block text-secondary">{{ comment.created_at|date:"d.m.Y H:i" }}</small>
                    {% if user == comment.author %}
                        <a href="{% url 'comment_edit' comment.pk %}" class="btn btn-sm btn-outline-secondary me-2 mt-2">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏</a>
                        <a href="{% url 'comment_delete' comment.pk %}" class="btn btn-sm btn-outline-secondary mt-2">–í–∏–¥–∞–ª–∏—Ç–∏</a>
                    {% endif %}
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p class="text-secondary">–ö–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤ —â–µ –Ω–µ–º–∞—î.</p>
    {% endif %}
</div>

{% if user.is_authenticated %}
<div class="card bg-dark border border-secondary rounded-4 p-4 text-light">
    <h3 class="fw-bold mb-3">–ù–∞–ø–∏—Å–∞—Ç–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä</h3>
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="mb-3">
            <label for="id_content" class="form-label">–ö–æ–º–µ–Ω—Ç–∞—Ä</label>
            {{ form.content }}
        </div>
        <div class="mb-3">
            <label for="id_file" class="form-label">–í–∏–±—Ä–∞—Ç–∏ —Ñ–∞–π–ª (–Ω–µ–æ–±–æ–≤'—è–∑–∫–æ–≤–æ)</label>
            {{ form.file }}
        </div>
        <button type="submit" class="btn btn-light">–î–æ–¥–∞—Ç–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä</button>
    </form>
</div>
{% else %}
<div class="alert alert-warning mt-4" role="alert">
    –£–≤—ñ–π–¥—ñ—Ç—å, —â–æ–± –∑–∞–ª–∏—à–∏—Ç–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä.
</div>
{% endif %}
{% endblock %}
