{% extends 'base.html' %}

{% block content %}
<div class="card shadow-lg p-4 my-4 bg-dark border border-info rounded-4 text-info">
    <h1 class="card-title mb-3 fw-bold text-uppercase text-info">–ó–∞–≤–¥–∞–Ω–Ω—è: {{ task.title }}</h1>

    <ul class="list-group list-group-flush mb-3">
        <li class="list-group-item bg-transparent d-flex justify-content-between align-items-center text-info border-info border-start border-4">
            <strong>–°—Ç–∞—Ç—É—Å:</strong>
            <span class="badge 
                {% if task.status == 'completed' %}bg-success text-dark
                {% elif task.status == 'in_progress' %}bg-warning text-dark
                {% else %}bg-secondary text-light{% endif %} rounded-pill fw-semibold">
                {{ task.get_status_display }}
            </span>
        </li>
        <li class="list-group-item bg-transparent d-flex justify-content-between align-items-center text-info border-info border-start border-4">
            <strong>–ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç:</strong>
            <span class="badge bg-info text-dark rounded-pill fw-semibold">{{ task.get_priority_display }}</span>
        </li>
        <li class="list-group-item bg-transparent text-info border-info border-start border-4">
            <strong>–û–ø–∏—Å:</strong><br>
            <p class="mt-2">{{ task.description|linebreaks }}</p>
        </li>
    </ul>

    <small class="text-secondary d-block text-end fst-italic">
        –°—Ç–≤–æ—Ä–µ–Ω–æ: {{ task.created_by.username }} &mdash; {{ task.created_at|date:"d.m.Y H:i" }}
    </small>
</div>

<hr class="my-4">

<h2>–ö–æ–º–µ–Ω—Ç–∞—Ä—ñ</h2>
<ul>
  {% for comment in comments %}
    <li>
      <strong>{{ comment.author }}</strong>: {{ comment.content }}<br>
      {% if comment.file %}
        <a href="{{ comment.file.url }}" download>üìé {{ comment.file.name }}</a><br>
      {% endif %}
      {{ comment.likes.count }} ‚ù§
      <form method="post" action="{% url 'like_comment' comment.pk %}">
        {% csrf_token %}
        <button type="submit">–õ–∞–π–∫</button>
      </form>
      <small>{{ comment.created_at }}</small><br>
      {% if user == comment.author %}
        <a href="{% url 'comment_edit' comment.pk %}">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏</a>
        <a href="{% url 'comment_delete' comment.pk %}">–í–∏–¥–∞–ª–∏—Ç–∏</a>
      {% endif %}
    </li>
  {% empty %}
    <li>–ö–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤ —â–µ –Ω–µ–º–∞—î.</li>
  {% endfor %}
</ul>

{% if user.is_authenticated %}
<form method="post" enctype="multipart/form-data" class="mt-3">
  {% csrf_token %}
  {{ form.as_p }}
  <button type="submit" class="btn btn-primary">–î–æ–¥–∞—Ç–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä</button>
</form>
{% else %}
<p>–£–≤—ñ–π–¥—ñ—Ç—å, —â–æ–± –∑–∞–ª–∏—à–∏—Ç–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä.</p>
{% endif %}
{% endblock %}
