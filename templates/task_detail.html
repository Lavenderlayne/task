{% extends 'base.html' %}

{% block content %}
<div class="card shadow-lg p-4 my-4 bg-dark border border-info rounded-4 text-info">
    <h1 class="card-title mb-3 fw-bold text-uppercase text-info">–ó–∞–≤–¥–∞–Ω–Ω—è: {{ task.title }}</h1>

    <ul class="list-group list-group-flush mb-3">
        <li class="list-group-item bg-transparent d-flex justify-content-between align-items-center text-info border-info border-start border-4">
            <strong>–°—Ç–∞—Ç—É—Å:</strong>
            <span class="badge 
                {% if task.status == 'completed' %}bg-success text-dark
                {% elif task.status == 'in_progress' %}bg-warning text-dark
                {% else %}bg-secondary text-light{% endif %} rounded-pill fw-semibold">
                {{ task.get_status_display }}
            </span>
        </li>
        <li class="list-group-item bg-transparent d-flex justify-content-between align-items-center text-info border-info border-start border-4">
            <strong>–ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç:</strong>
            <span class="badge bg-info text-dark rounded-pill fw-semibold">{{ task.get_priority_display }}</span>
        </li>
        <li class="list-group-item bg-transparent text-info border-info border-start border-4">
            <strong>–û–ø–∏—Å:</strong><br>
            <p class="mt-2">{{ task.description|linebreaks }}</p>
        </li>
    </ul>

    <small class="text-secondary d-block text-end fst-italic">
        –°—Ç–≤–æ—Ä–µ–Ω–æ: {{ task.created_by.username }} &mdash; {{ task.created_at|date:"d.m.Y H:i" }}
    </small>
</div>

<hr class="my-4 text-info">

<div class="card bg-dark border border-info rounded-4 p-4 text-info mb-4">
    <h2 class="fw-bold mb-3 text-info">–ö–æ–º–µ–Ω—Ç–∞—Ä—ñ</h2>

    {% if comments %}
        <ul class="list-group list-group-flush">
            {% for comment in comments %}
                <li class="list-group-item bg-transparent border-info text-info">
                    <p class="mb-1"><strong>{{ comment.author }}</strong>: {{ comment.content }}</p>
                    {% if comment.file %}
                        <p><a href="{{ comment.file.url }}" class="link-info" download>üìé {{ comment.file.name }}</a></p>
                    {% endif %}
                    <p class="mb-1">{{ comment.likes.count }} ‚ù§</p>
                    <form method="post" action="{% url 'like_comment' comment.pk %}" class="d-inline">
                        {% csrf_token %}
                        <button type="submit" class="btn btn-sm btn-outline-info">–õ–∞–π–∫</button>
                    </form>
                    <small class="d-block text-secondary">{{ comment.created_at|date:"d.m.Y H:i" }}</small>
                    {% if user == comment.author %}
                        <a href="{% url 'comment_edit' comment.pk %}" class="btn btn-sm btn-outline-warning me-2 mt-2">–†–µ–¥–∞–≥—É–≤–∞—Ç–∏</a>
                        <a href="{% url 'comment_delete' comment.pk %}" class="btn btn-sm btn-outline-danger mt-2">–í–∏–¥–∞–ª–∏—Ç–∏</a>
                    {% endif %}
                </li>
            {% endfor %}
        </ul>
    {% else %}
        <p class="text-secondary">–ö–æ–º–µ–Ω—Ç–∞—Ä—ñ–≤ —â–µ –Ω–µ–º–∞—î.</p>
    {% endif %}
</div>

{% if user.is_authenticated %}
<div class="card bg-dark border border-info rounded-4 p-4 text-info">
    <h3 class="fw-bold mb-3 text-info">–ù–∞–ø–∏—Å–∞—Ç–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä</h3>
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        <div class="mb-3">
            <label for="id_content" class="form-label">–ö–æ–º–µ–Ω—Ç–∞—Ä</label>
            {{ form.content }}
        </div>
        <div class="mb-3">
            <label for="id_file" class="form-label">–í–∏–±—Ä–∞—Ç–∏ —Ñ–∞–π–ª (–Ω–µ–æ–±–æ–≤'—è–∑–∫–æ–≤–æ)</label>
            {{ form.file }}
        </div>
        <button type="submit" class="btn btn-primary">–î–æ–¥–∞—Ç–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä</button>
    </form>
</div>
{% else %}
<div class="alert alert-warning mt-4" role="alert">
    –£–≤—ñ–π–¥—ñ—Ç—å, —â–æ–± –∑–∞–ª–∏—à–∏—Ç–∏ –∫–æ–º–µ–Ω—Ç–∞—Ä.
</div>
{% endif %}
{% endblock %}
